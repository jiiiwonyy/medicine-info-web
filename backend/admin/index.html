<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>XML 업로드 관리자 페이지</title>
    <style>
      body {
        font-family: Arial;
        padding: 40px;
        max-width: 520px;
        margin: auto;
      }
      .box {
        border: 1px solid #ccc;
        padding: 20px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>XML 업로드 (관리자 전용)</h1>

    <!-- 로그인 박스 -->
    <div id="login-box" class="box">
      <h3>관리자 로그인</h3>
      <input type="password" id="password" placeholder="관리자 비밀번호" />
      <button onclick="login()">로그인</button>
      <p id="login-msg" style="color: red"></p>
    </div>

    <!-- 업로드 박스 (초기에는 숨김) -->
    <div id="upload-box" class="box" style="display: none">
      <h3>XML 업로드</h3>

      <form id="upload-form">
        <label>Medicine ID</label><br />
        <input type="number" name="medicine_id" required /><br /><br />

        <label>Category</label><br />
        <input type="text" name="category" required /><br /><br />

        <label>XML 파일</label><br />
        <input type="file" name="file" accept=".xml" required /><br /><br />

        <button type="submit">업로드</button>
      </form>

      <p id="upload-msg"></p>
    </div>

    <script>
      let token = '';

      async function login() {
        const pw = document.getElementById('password').value;

        const res = await fetch('/admin/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: pw }),
        });

        const data = await res.json();

        if (data.success) {
          token = data.token;
          document.getElementById('login-box').style.display = 'none';
          document.getElementById('upload-box').style.display = 'block';
        } else {
          document.getElementById('login-msg').innerText =
            '비밀번호가 틀렸습니다.';
        }
      }

      document
        .getElementById('upload-form')
        .addEventListener('submit', async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);

          const res = await fetch('/admin/upload-xml', {
            method: 'POST',
            headers: {
              'x-admin-token': token,
            },
            body: formData,
          });

          const data = await res.json();
          document.getElementById('upload-msg').innerText =
            data.status === 'success' ? '업로드 완료!' : '오류 발생 ❌';
        });
    </script>
  </body>
</html>
